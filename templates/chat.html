<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>تطبيق الدردشة</title>
    <style>
        body { font-family: 'Tahoma'; background: #f9f9f9; padding: 20px; direction: rtl; }
        .chat-box { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
        .messages { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .message { margin-bottom: 10px; }
        .message strong { color: #007bff; }
    </style>
</head>
<body>
    <h2>الدردشة</h2>
    <div id="messages"></div>
    <form id="chat-form">
        <input type="text" id="message" placeholder="أدخل رسالتك هنا..." required>
        <button type="submit">إرسال</button>
    </form>
</body>
<script>
    // تحميل الرسائل
    function loadMessages() {
        fetch('/get_messages')
            .then(response => response.json())
            .then(data => {
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML = '';
                data.messages.forEach(msg => {
                    messagesDiv.innerHTML += `<p><strong>${msg.username}</strong>: ${msg.message}</p>`;
                });
            });
    }

    // إرسال رسالة
    document.getElementById('chat-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const message = document.getElementById('message').value;
        fetch('/send_message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: message })
        }).then(() => {
            loadMessages();  // إعادة تحميل الرسائل بعد إرسالها
            document.getElementById('message').value = '';  // مسح الحقل
        });
    });

    // تحميل الرسائل عند تحميل الصفحة
    loadMessages();
</script>
</html>